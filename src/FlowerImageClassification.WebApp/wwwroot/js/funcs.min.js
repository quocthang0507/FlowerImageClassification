function getRandomArbitraryNumber(n,t){return Math.round(Math.random()*(t-n)+n)}function takeSnapshot(){Webcam.snap(function(n){document.getElementById("inputWebcam").src=n})}function addLoadingClass(){$("body").addClass("loading")}function removeLoadingClass(){$("body").removeClass("loading")}function validateFileExtension(){var n=document.querySelector("[type=file]"),i=n.value,t;if(n.files.length==0)alert("Hình ảnh không được để trống!");else if(/(\.jpg|\.png)$/i.exec(i)){if(n.files&&n.files[0]){const i=n.files[0].size,r=Math.round(i/1024);return r>2048?(alert("Kích thước tập tin quá lớn, vui lòng gửi tập tin nhỏ hơn 2MB."),!1):(t=new FileReader,t.onload=function(n){document.getElementById("divResult_left").style.visibility="visible";document.getElementById("divImagePreview").innerHTML='<img class="imgPreview" src="'+n.target.result+'"/>'},t.readAsDataURL(n.files[0]),!0)}}else alert("Chỉ chấp nhận hình JPG và PNG!"),n.value="";return!1}function customFileInput(){$(".custom-file-input").on("change",function(){var n=$(this).val().split("\\").pop();$(this).siblings(".custom-file-label").addClass("selected").html(n)})}function uploadAndClassify(n){var t,i,r;if(n.preventDefault(),t="",i=new FormData,inputFile!=null){const n=inputFile.files;if(!validateFileExtension())return;i.append("imageFile",n[0]);t="api/ClassifyImage"}else r=document.getElementById("inputWebcam").src,i.append("base64image",r),t="api/ClassifyBase64";addLoadingClass();fetch(t,{method:"POST",body:i}).then(n=>n.json()).then(n=>{console.log("Đã nhận được phản hồi: ",n),document.getElementById("divResult_right").style.visibility="visible",document.getElementById("divImageId").innerHTML="Tên tập tin vừa tải lên: "+n.imageID,document.getElementById("divPrediction").innerHTML=`Kết quả dự đoán là: ${dict[n.predictedLabel]}`,document.getElementById("divEnPrediction").innerHTML=n.predictedLabel,document.getElementById("divProbability").innerHTML="Xác suất: "+(n.probability*100).toFixed(3)+"%",document.getElementById("divExecutionTime").innerHTML="Thời gian dự đoán: "+n.predictionExecutionTime+" mili giây",getInfo(n.predictedLabel),removeLoadingClass()}).catch(n=>{console.error("Đã có lỗi xảy ra: ",n),alert("Đã có lỗi xảy ra, vui lòng thử lại."),removeLoadingClass()})}function getInfo(n){var t="api/GetInfo/"+n;$.get(t,function(n){document.querySelector("#modal-info > div > div > div.modal-body").innerHTML=n})}function SubmitUserSentiment(n){var i,t,r;if(n.preventDefault(),confirm("Bạn có muốn đóng góp ảnh này vào hệ thống nhằm mục đích cải thiện mô hình không?")){i="api/Contribution";t=new FormData;const n=document.getElementById("divEnPrediction").innerHTML;if(inputFile!=null){const i=inputFile.files;if(!validateFileExtension())return;t.append("imageFile",i[0]);t.append("predictedLabel",n)}else r=document.getElementById("inputWebcam").src,t.append("base64image",r),t.append("predictedLabel",n),i="api/Base64Contribution";fetch(i,{method:"POST",body:t}).then(n=>n.json()).then(n=>{alert("Đóng góp thành công."),console.log("Đã nhận được đóng góp: ",n)}).catch(n=>{console.error("Lỗi gửi đóng góp: ",n),alert("Lỗi gửi đóng góp lên server.")})}else console.log("Đã từ chối đóng góp ảnh")}function UpdateLabel(n){var t=new FormData;const i=document.getElementById(n).value;t.append("id",n);t.append("newLabel",i);fetch("api/UpdateLabel",{method:"POST",body:t}).then().then(()=>{alert("Cập nhật nhãn mới thành công"),console.log("Cập nhật nhãn mới thành công.")}).catch(n=>{console.error("Lỗi cập nhật nhãn mới: ",n),alert("Lỗi cập nhật nhãn mới.")})}function MarkComplete(n){var i=window.location.origin+"/api/MarkComplete",t=new FormData;t.append("id",n);fetch(i,{method:"POST",body:t}).then().then(()=>{alert("Đánh dấu hoàn tất thành công"),console.log("Đánh dấu hoàn tất thành công."),ReloadASentiment(n)}).catch(n=>{console.error("Lỗi đánh dấu hoàn tất: ",n),alert("Lỗi đánh dấu hoàn tất.")})}function UnmarkComplete(n){var i=window.location.origin+"/api/UnmarkComplete",t=new FormData;t.append("id",n);fetch(i,{method:"POST",body:t}).then().then(()=>{alert("Hoàn tác đánh dấu thành công"),console.log("Hoàn tác đánh dấu thành công."),ReloadASentiment(n)}).catch(n=>{console.error("Lỗi hoàn tác đánh dấu: ",n),alert("Lỗi hoàn tác đánh dấu.")})}function ReloadASentiment(n){var t=window.location.origin+"/api/GetSentiment/"+n;$.get(t,function(t,i){if(i=="success"){var r=document.getElementById(n).parentElement;r.innerHTML="";t.visible?r.appendChild(GenerateNode("button",n,"btn btn-primary","Đánh dấu đã xử lý",`MarkComplete(${n})`)):(r.appendChild(GenerateNode("button",n,"btn btn-info","Đã xử lý")),r.appendChild(GenerateNode("button",n,"btn btn-danger","Hoàn tác",`UnmarkComplete(${n})`)))}else i=="error"&&console.error("Lỗi khi lấy thông tin: ",t)})}function GenerateNode(n,t,i,r,u=null){var f=document.createElement(n);return f.id=t,f.className=i,f.innerHTML=r,u!=null&&f.setAttribute("onclick",u),f}